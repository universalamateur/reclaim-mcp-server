# Plan: v0.8.0 - Distribution Ready

## Summary

Make the Reclaim MCP Server production-ready for public distribution with:
1. **Tool Profiles** - Allow users to enable minimal/standard/full tool sets
2. **GitLab CI Release Pipeline** - Automated build and publish on tag
3. **Distribution** - PyPI publication + registry listings

---

## Part 1: Tool Profiles

### New Environment Variable
```
RECLAIM_TOOL_PROFILE=full  # Options: minimal, standard, full (default)
```

### Profile Definitions

| Profile | Tools | Description |
|---------|-------|-------------|
| `minimal` | 20 | Core tasks + habits basics |
| `standard` | 33 | Core productivity (no niche tools) |
| `full` | 42 | All tools (default) |

### Tools by Profile

**Minimal (20 tools)**:
- Tasks: list_tasks, create_task, update_task, mark_task_complete, delete_task, get_task, list_completed_tasks
- Habits: list_habits, create_habit, update_habit, delete_habit, mark_habit_done, skip_habit
- Events: list_events, list_personal_events, get_event
- Focus: get_focus_settings
- System: health_check, verify_connection
- Analytics: get_user_analytics

**Standard (33 tools)** - adds:
- Tasks: add_time_to_task, start_task, stop_task, prioritize_task, restart_task
- Habits: enable_habit, disable_habit
- Focus: update_focus_settings, lock_focus_block, unlock_focus_block, reschedule_focus_block
- Analytics: get_focus_insights

**Full (42 tools)** - adds:
- Events: pin_event, unpin_event, set_event_rsvp, move_event
- Habits: lock_habit_instance, unlock_habit_instance, start_habit, stop_habit, convert_event_to_habit

### Implementation

**File: `src/reclaim_mcp/config.py`**
```python
class Settings(BaseSettings):
    api_key: str
    base_url: str = "https://api.app.reclaim.ai"
    tool_profile: str = "full"  # NEW
```

**File: `src/reclaim_mcp/profiles.py`** (NEW)
```python
MINIMAL_TOOLS = {...}  # 20 tool names
STANDARD_TOOLS = {...}  # 33 tool names
FULL_TOOLS = {...}      # 42 tool names

PROFILES = {
    "minimal": MINIMAL_TOOLS,
    "standard": STANDARD_TOOLS,
    "full": FULL_TOOLS,
}

def is_tool_enabled(tool_name: str, profile: str = "full") -> bool:
    return tool_name in PROFILES.get(profile, FULL_TOOLS)
```

**File: `src/reclaim_mcp/server.py`**
- Add conditional registration based on profile
- Option A: Check profile before each `@mcp.tool` registration
- Option B: Register all, then filter at startup

---

## Part 2: GitLab CI Release Pipeline

### New CI/CD Variables (GitLab Settings)
- `PYPI_TOKEN` - PyPI API token for publishing

### New `.gitlab-ci.yml` Stage

```yaml
stages:
  - lint
  - test
  - security
  - release  # NEW

build:
  stage: release
  image: python:3.10
  extends: .poetry-setup
  script:
    - poetry build
  artifacts:
    paths:
      - dist/
  rules:
    - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/

publish-pypi:
  stage: release
  image: python:3.10
  needs: [build]
  script:
    - pip install twine
    - twine upload dist/* -u __token__ -p $PYPI_TOKEN
  rules:
    - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/

create-release:
  stage: release
  image: registry.gitlab.com/gitlab-org/release-cli:latest
  needs: [publish-pypi]
  script:
    - echo "Creating release for $CI_COMMIT_TAG"
  release:
    tag_name: $CI_COMMIT_TAG
    description: "Release $CI_COMMIT_TAG"
  rules:
    - if: $CI_COMMIT_TAG =~ /^v\d+\.\d+\.\d+$/
```

---

## Part 3: Distribution

### PyPI Publication
- Package name: `reclaim-mcp-server`
- Install: `pip install reclaim-mcp-server` or `uvx reclaim-mcp-server`
- Entry point already configured in pyproject.toml

### Registry Listings (Manual)
1. **Smithery.ai** - Submit after PyPI publication
2. **Glama** - Submit after PyPI publication

### README Updates
- Add PyPI badge
- Add installation instructions: `pip install reclaim-mcp-server`
- Add tool profile documentation
- Add uvx usage examples

---

## Files to Modify

| File | Change |
|------|--------|
| `src/reclaim_mcp/config.py` | Add `tool_profile` field |
| `src/reclaim_mcp/profiles.py` | **CREATE** - profile definitions |
| `src/reclaim_mcp/server.py` | Conditional tool registration |
| `.gitlab-ci.yml` | Add release stage |
| `README.md` | Add PyPI install, profile docs |
| `pyproject.toml` | Version bump to 0.8.0 |
| `src/reclaim_mcp/__init__.py` | Version bump |
| `tests/test_server.py` | Version assertion update |

---

## Order of Operations

1. Create `profiles.py` with tool profile definitions
2. Update `config.py` with `tool_profile` setting
3. Update `server.py` for conditional registration
4. Add tests for profile loading
5. Update `.gitlab-ci.yml` with release pipeline
6. Update README with installation and profile docs
7. Bump version to 0.8.0 (3 locations + poetry lock)
8. Run full test suite and linting
9. Commit and tag v0.8.0
10. Verify PyPI publication
11. Submit to Smithery/Glama

---

## Testing

1. Unit tests for profile loading
2. Verify each profile loads correct number of tools
3. Test with `RECLAIM_TOOL_PROFILE=minimal` env var
4. CI pipeline test on branch before tag
